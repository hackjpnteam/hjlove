<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”»åƒãƒ‡ãƒãƒƒã‚°</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
        }
        .image-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .image-card {
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .test-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
        .debug-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ” ç”»åƒè¡¨ç¤ºãƒ‡ãƒãƒƒã‚°</h1>
        
        <div class="image-test" id="imageTest"></div>
        
        <div id="debugLog" style="background: #f0f0f0; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        let debugLog = [];
        
        function log(message) {
            debugLog.push(message);
            document.getElementById('debugLog').innerHTML = debugLog.join('<br>');
            console.log(message);
        }

        function estimateGender(name, occupation = '') {
            log(`æ€§åˆ¥æ¨å®š: ${name} (${occupation})`);
            
            const femaleIndicators = ['ã¡ã‹', 'èŠ±å­', 'ç¾å’²', 'å­', 'ç¾', 'æµ', 'é¦™', 'å¥ˆ', 'èœ', 'èŠ±', 'è¯', 'æ„›', 'å½©', 'å’²'];
            const maleIndicators = ['å…‰', 'å¤ªéƒ', 'å¥', 'èª ', 'æ´‹', 'åš', 'é›„', 'ç”·', 'å¤«', 'å½¦'];
            
            for (let indicator of femaleIndicators) {
                if (name.includes(indicator)) {
                    log(`â†’ å¥³æ€§åˆ¤å®š: "${indicator}" ãŒå«ã¾ã‚Œã‚‹`);
                    return 'female';
                }
            }
            
            for (let indicator of maleIndicators) {
                if (name.includes(indicator)) {
                    log(`â†’ ç”·æ€§åˆ¤å®š: "${indicator}" ãŒå«ã¾ã‚Œã‚‹`);
                    return 'male';
                }
            }
            
            log(`â†’ ä¸æ˜åˆ¤å®š`);
            return 'unknown';
        }

        function generateGenderIcon(name, gender, occupation = '') {
            if (gender === 'unknown') {
                gender = estimateGender(name, occupation);
            }

            const gradients = {
                male: ['2196F3', '1976D2'],     
                female: ['E91E63', 'C2185B'],   
                unknown: ['9E9E9E', '616161']   
            };

            const icons = {
                male: 'M',      
                female: 'F',    
                unknown: '?'    
            };

            const labels = {
                male: 'ç”·æ€§',
                female: 'å¥³æ€§',
                unknown: 'ä¸æ˜'
            };

            const colors = gradients[gender] || gradients.unknown;
            const icon = icons[gender] || icons.unknown;
            const label = labels[gender] || labels.unknown;
            
            const displayName = name.length > 4 ? name.substring(0, 3) + '...' : name;
            
            const result = {
                url: `https://via.placeholder.com/300x300/${colors[0]}/ffffff?text=${encodeURIComponent(icon + ' ' + displayName)}`,
                gender: gender,
                icon: icon,
                label: label,
                color: colors[0]
            };
            
            log(`ã‚¢ã‚¤ã‚³ãƒ³ç”Ÿæˆ: ${name} â†’ ${result.url}`);
            return result;
        }

        // ãƒ†ã‚¹ãƒˆç”¨ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
        const testProfiles = [
            { name: "åœ’ç”°å½©æ›", image: "ayaka/profile.jpg", occupation: "å¤§å­¦é™¢ç”Ÿ" },
            { name: "ä¸Šæ—ã¡ã‹", image: null, occupation: "ãƒ©ã‚¤ãƒ•ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼" },
            { name: "æˆ¸æ‘å…‰", image: null, occupation: "èµ·æ¥­å®¶" },
            { name: "ç”°ä¸­èŠ±å­", image: null, occupation: "ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼" },
            { name: "å±±ç”°å¤ªéƒ", image: null, occupation: "å–¶æ¥­" }
        ];

        function createTestCard(profile) {
            log(`\n=== ${profile.name} ã®ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ ===`);
            log(`å…ƒç”»åƒ: ${profile.image || 'ãªã—'}`);
            
            const gender = estimateGender(profile.name, profile.occupation);
            const genderData = generateGenderIcon(profile.name, gender, profile.occupation);
            
            let imageUrl = genderData.url;
            let useRealImage = false;
            
            if (profile.image && !profile.image.startsWith('https://via.placeholder.com')) {
                imageUrl = profile.image;
                useRealImage = true;
                log(`å®Ÿç”»åƒã‚’ä½¿ç”¨: ${imageUrl}`);
            } else {
                log(`è‡ªå‹•ç”Ÿæˆã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ç”¨: ${imageUrl}`);
            }

            return `
                <div class="image-card">
                    <img src="${imageUrl}" alt="${profile.name}" class="test-image" 
                         onerror="handleImageError(this, '${profile.name}', '${profile.occupation}')"
                         onload="handleImageLoad('${profile.name}')">
                    <div><strong>${profile.name}</strong></div>
                    <div>${genderData.label} (${genderData.icon})</div>
                    <div class="debug-info">
                        ç”»åƒã‚¿ã‚¤ãƒ—: ${useRealImage ? 'å®Ÿç”»åƒ' : 'è‡ªå‹•ç”Ÿæˆ'}<br>
                        URL: ${imageUrl.substring(0, 50)}...
                    </div>
                </div>
            `;
        }

        function handleImageError(img, name, occupation) {
            log(`âŒ ç”»åƒã‚¨ãƒ©ãƒ¼: ${name}`);
            const genderData = generateGenderIcon(name, 'unknown', occupation);
            img.src = genderData.url;
            log(`â†’ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ${genderData.url}`);
        }

        function handleImageLoad(name) {
            log(`âœ… ç”»åƒèª­ã¿è¾¼ã¿æˆåŠŸ: ${name}`);
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        log('=== ç”»åƒè¡¨ç¤ºãƒ‡ãƒãƒƒã‚°é–‹å§‹ ===');
        const testContainer = document.getElementById('imageTest');
        testContainer.innerHTML = testProfiles.map(profile => createTestCard(profile)).join('');
    </script>
</body>
</html>