<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>画像デバッグ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
        }
        .image-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .image-card {
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .test-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }
        .debug-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🔍 画像表示デバッグ</h1>
        
        <div class="image-test" id="imageTest"></div>
        
        <div id="debugLog" style="background: #f0f0f0; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        let debugLog = [];
        
        function log(message) {
            debugLog.push(message);
            document.getElementById('debugLog').innerHTML = debugLog.join('<br>');
            console.log(message);
        }

        function estimateGender(name, occupation = '') {
            log(`性別推定: ${name} (${occupation})`);
            
            const femaleIndicators = ['ちか', '花子', '美咲', '子', '美', '恵', '香', '奈', '菜', '花', '華', '愛', '彩', '咲'];
            const maleIndicators = ['光', '太郎', '健', '誠', '洋', '博', '雄', '男', '夫', '彦'];
            
            for (let indicator of femaleIndicators) {
                if (name.includes(indicator)) {
                    log(`→ 女性判定: "${indicator}" が含まれる`);
                    return 'female';
                }
            }
            
            for (let indicator of maleIndicators) {
                if (name.includes(indicator)) {
                    log(`→ 男性判定: "${indicator}" が含まれる`);
                    return 'male';
                }
            }
            
            log(`→ 不明判定`);
            return 'unknown';
        }

        function generateGenderIcon(name, gender, occupation = '') {
            if (gender === 'unknown') {
                gender = estimateGender(name, occupation);
            }

            const gradients = {
                male: ['2196F3', '1976D2'],     
                female: ['E91E63', 'C2185B'],   
                unknown: ['9E9E9E', '616161']   
            };

            const icons = {
                male: 'M',      
                female: 'F',    
                unknown: '?'    
            };

            const labels = {
                male: '男性',
                female: '女性',
                unknown: '不明'
            };

            const colors = gradients[gender] || gradients.unknown;
            const icon = icons[gender] || icons.unknown;
            const label = labels[gender] || labels.unknown;
            
            const displayName = name.length > 4 ? name.substring(0, 3) + '...' : name;
            
            const result = {
                url: `https://via.placeholder.com/300x300/${colors[0]}/ffffff?text=${encodeURIComponent(icon + ' ' + displayName)}`,
                gender: gender,
                icon: icon,
                label: label,
                color: colors[0]
            };
            
            log(`アイコン生成: ${name} → ${result.url}`);
            return result;
        }

        // テスト用プロフィール
        const testProfiles = [
            { name: "園田彩掛", image: "ayaka/profile.jpg", occupation: "大学院生" },
            { name: "上林ちか", image: null, occupation: "ライフプランナー" },
            { name: "戸村光", image: null, occupation: "起業家" },
            { name: "田中花子", image: null, occupation: "デザイナー" },
            { name: "山田太郎", image: null, occupation: "営業" }
        ];

        function createTestCard(profile) {
            log(`\n=== ${profile.name} のカード生成 ===`);
            log(`元画像: ${profile.image || 'なし'}`);
            
            const gender = estimateGender(profile.name, profile.occupation);
            const genderData = generateGenderIcon(profile.name, gender, profile.occupation);
            
            let imageUrl = genderData.url;
            let useRealImage = false;
            
            if (profile.image && !profile.image.startsWith('https://via.placeholder.com')) {
                imageUrl = profile.image;
                useRealImage = true;
                log(`実画像を使用: ${imageUrl}`);
            } else {
                log(`自動生成アイコンを使用: ${imageUrl}`);
            }

            return `
                <div class="image-card">
                    <img src="${imageUrl}" alt="${profile.name}" class="test-image" 
                         onerror="handleImageError(this, '${profile.name}', '${profile.occupation}')"
                         onload="handleImageLoad('${profile.name}')">
                    <div><strong>${profile.name}</strong></div>
                    <div>${genderData.label} (${genderData.icon})</div>
                    <div class="debug-info">
                        画像タイプ: ${useRealImage ? '実画像' : '自動生成'}<br>
                        URL: ${imageUrl.substring(0, 50)}...
                    </div>
                </div>
            `;
        }

        function handleImageError(img, name, occupation) {
            log(`❌ 画像エラー: ${name}`);
            const genderData = generateGenderIcon(name, 'unknown', occupation);
            img.src = genderData.url;
            log(`→ フォールバック: ${genderData.url}`);
        }

        function handleImageLoad(name) {
            log(`✅ 画像読み込み成功: ${name}`);
        }

        // テスト実行
        log('=== 画像表示デバッグ開始 ===');
        const testContainer = document.getElementById('imageTest');
        testContainer.innerHTML = testProfiles.map(profile => createTestCard(profile)).join('');
    </script>
</body>
</html>